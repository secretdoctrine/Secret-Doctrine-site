- tree_element.child_elements.each do |child_element|
  - li_class = ((child_element.is_open) ? 'jstree-open' : '')
  - li_class += child_element.is_current ? ' selected_li' : ''
  - span_class = child_element.type == 'category' ? '' : 'tree_book'
  - span_class += first ? ' white' : ''
  - if !child_element.is_popup
    %li{class: "#{li_class}", selected: "#{child_element.selected}", type: "#{child_element.type + '#' + child_element.id.to_s}"}
      = link_to child_element.link_target do
        %span{class: 'tree_prefix'}
          = child_element.tree_prefix
        %span{class: span_class}
          = child_element.name

      - if not child_element.child_elements.empty?
        %ul
          = render partial: 'refinery/books/search_results/search_tree_level_li', locals: {tree_element: child_element, first: FALSE}